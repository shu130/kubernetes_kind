# k8s-web-app/05-frontend-configmap.yaml
# ConfigMap = ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è¨­å®šï¼ˆnginxè¨­å®š + HTMLï¼‰

apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-config
  namespace: k8s-web-app
data:
  # nginxè¨­å®šï¼ˆ/api ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ api-svc ã«è»¢é€ï¼‰
  default.conf: |
    server {
        listen 80;
        server_name localhost;

        # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ä¿¡
        location / {
            root /usr/share/nginx/html;
            index index.html;
        }

        # /api ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ api-svc ã«è»¢é€
        location /api/ {
            proxy_pass http://api-svc/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }
    }

  # ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸HTMLï¼ˆå‹•ä½œç¢ºèªç”¨ï¼‰
  index.html: |
    <!DOCTYPE html>
    <html lang="ja">
    <head>
      <meta charset="UTF-8">
      <title>k8s Web App</title>
      <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        h1 { color: #326CE5; }
        .status { padding: 15px; border-radius: 8px; margin: 10px 0; }
        .ok { background: #e8f5e9; border: 1px solid #4CAF50; }
        .info { background: #e3f2fd; border: 1px solid #2196F3; }
        code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; }
      </style>
    </head>
    <body>
      <h1>â˜¸ï¸ k8s Web App</h1>
      <p>Kubernetesè¨­è¨ˆãƒ»æ§‹ç¯‰ãƒ¡ãƒ¢ â€” ç¬¬7å› ç·åˆæ¼”ç¿’</p>

      <div class="status ok">
        âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™
      </div>

      <div class="status info">
        ğŸ“¡ APIã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ï¼š<br>
        <code>curl http://localhost:8080/api/health</code>
      </div>

      <h2>æ§‹æˆ</h2>
      <ul>
        <li>ğŸª Frontend: nginxï¼ˆã“ã®ãƒšãƒ¼ã‚¸ï¼‰</li>
        <li>ğŸ³ API: nginxï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼‰</li>
        <li>ğŸ—„ï¸ DB: PostgreSQL</li>
      </ul>
    </body>
    </html>
